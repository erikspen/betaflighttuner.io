<html>
    <head>
        <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="betaflight_rates.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <script type="text/javascript">

            var doDraw=true;
            var checkBox = null;
            var checkOptions = [];
            var showRf=false;
            var rfRateSet = [];

            var clamp = function(n, minn, maxn) {
                if(isNaN(n))
                    n=0.5;
                return Math.max(Math.min(maxn, n), minn)
            }

            // BF rate calculation function
            var bfcalc = function(rcCommand, rcRate, expo, superRate) {

                rcCommand=clamp(rcCommand,0,1);
                var absRcCommand = Math.abs(rcCommand);

                if(rcRate > 2.0)
                    rcRate = rcRate + (14.54 * (rcRate - 2.0))

                if(expo != 0)
                    rcCommand = rcCommand * Math.abs(rcCommand)**3 * expo + rcCommand * (1.0 - expo)

                angleRate = 200.0 * rcRate * rcCommand;
                if(superRate != 0){
                    rcSuperFactor = 1.0 / (clamp(1.0 - absRcCommand * (superRate), 0.01, 1.00))
                    angleRate *= rcSuperFactor
                }

                return angleRate
            }

            //Race flight
            var rfcalc = function(rcCommand, rcRate, expo, superRate) {

                rcCommand=clamp(rcCommand,0,1);
                angleRate = ((1 + 0.01 * expo * (rcCommand * rcCommand - 1.0)) * rcCommand)
                angleRate = (angleRate * (rcRate + (Math.abs(angleRate) * rcRate * superRate * 0.01)))

                return angleRate
            }

            var bfD1 = function(rcCommand, rcRate, expo, superRate, expo_otx) {

                rcCommand=clamp(rcCommand,0,1);
                var absRcCommand = Math.abs(rcCommand);

                if(rcRate > 2.0)
                    rcRate = rcRate + (14.54 * (rcRate - 2.0))

                if (expo_otx==0){
                    angleRateD1 = -(200*rcRate*(3*expo*superRate*rcCommand**4 - 4*expo*rcCommand**3 + expo - 1))/(rcCommand*superRate - 1)**2;
                } else if (expo_otx<0){
                    angleRateD1 = (200*rcRate*((expo - 1)*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1) - 4*expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**3*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1)))/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1) - (200*rcRate*superRate*((expo - 1)*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**4)*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1))/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1)**2;
                } else {
                    angleRateD1 = (200*rcRate*superRate*((- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)*(expo - 1) + expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**4)*(3*expo_otx*rcCommand**2 - expo_otx + 1))/(superRate*(rcCommand*(expo_otx - 1) - expo_otx*rcCommand**3) + 1)**2 - (200*rcRate*((expo - 1)*(3*expo_otx*rcCommand**2 - expo_otx + 1) + 4*expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**3*(3*expo_otx*rcCommand**2 - expo_otx + 1)))/(superRate*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand) + 1);
                }

                return angleRateD1
            }

            var bfD2 = function(rcCommand, rcRate, expo, superRate, expo_otx) {

                rcCommand=clamp(rcCommand,0,1);
                var absRcCommand = Math.abs(rcCommand);

                if(rcRate > 2.0)
                    rcRate = rcRate + (14.54 * (rcRate - 2.0))

                if (expo_otx==0){
                    angleRateD2 = -(400*rcRate*(superRate - expo*superRate + 6*expo*rcCommand**2 - 8*expo*rcCommand**3*superRate + 3*expo*rcCommand**4*superRate**2))/(rcCommand*superRate - 1)**3;
                } else if (expo_otx<0){
                    angleRateD2 = (400*rcRate*superRate**2*((expo - 1)*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**4)*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1)**2)/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1)**3 - (400*rcRate*superRate*((expo - 1)*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1) - 4*expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**3*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1))*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1))/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1)**2 - (200*rcRate*(12*expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**2*(expo_otx - 3*expo_otx*(rcCommand - 1)**2 + 1)**2 + 3*expo_otx*(2*rcCommand - 2)*(expo - 1) - 12*expo*expo_otx*(2*rcCommand - 2)*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**3))/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1) + (600*expo_otx*rcRate*superRate*(2*rcCommand - 2)*((expo - 1)*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - expo*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1)**4))/(superRate*((expo_otx + 1)*(rcCommand - 1) - expo_otx*(rcCommand - 1)**3 + 1) - 1)**2;
                } else {
                    angleRateD2 = (400*rcRate*superRate**2*((- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)*(expo - 1) + expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**4)*(3*expo_otx*rcCommand**2 - expo_otx + 1)**2)/(superRate*(rcCommand*(expo_otx - 1) - expo_otx*rcCommand**3) + 1)**3 - (200*rcRate*(6*expo_otx*rcCommand*(expo - 1) - 12*expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**2*(3*expo_otx*rcCommand**2 - expo_otx + 1)**2 + 24*expo*expo_otx*rcCommand*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**3))/(superRate*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand) + 1) - (400*rcRate*superRate*((expo - 1)*(3*expo_otx*rcCommand**2 - expo_otx + 1) + 4*expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**3*(3*expo_otx*rcCommand**2 - expo_otx + 1))*(3*expo_otx*rcCommand**2 - expo_otx + 1))/(superRate*(rcCommand*(expo_otx - 1) - expo_otx*rcCommand**3) + 1)**2 + (1200*expo_otx*rcCommand*rcRate*superRate*((- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)*(expo - 1) + expo*(- expo_otx*rcCommand**3 + (expo_otx - 1)*rcCommand)**4))/(superRate*(rcCommand*(expo_otx - 1) - expo_otx*rcCommand**3) + 1)**2;
                }

                return angleRateD2
            }

            var rfD1 = function(rcCommand, rcRate, expo, superRate) {

                rcCommand=clamp(rcCommand,0,1);
                angleRateD1 = (rcRate*(3*expo*rcCommand**2-expo+100)*(100*rcCommand*superRate+expo*rcCommand**3*superRate-expo*rcCommand*superRate+5000))/500000;

                return angleRateD1
            }

            var rfD2 = function(rcCommand, rcRate, expo, superRate) {

                rcCommand=clamp(rcCommand,0,1);
                angleRateD2 = (rcRate*(15*superRate*expo**2*rcCommand**4-12*superRate*expo**2*rcCommand**2+superRate*expo**2+1200*superRate*expo*rcCommand**2+30000*expo*rcCommand-200*superRate*expo+10000*superRate))/500000;

                return angleRateD2
            }

            //Race flight --> Betaflight
            var rcConvert1 = function(rcRate_rf, expo_rf, superRate_rf, expo_otx,fittype) {

                if (expo_otx==0){
                    rcRate = (rcRate_rf*(superRate_rf + 100)*(expo_rf*superRate_rf - 100*superRate_rf + 10000))/200000000;
                    superRate = -(superRate_rf*(expo_rf - 100))/10000;
                    expo = (10000*expo_rf + 100*expo_rf*superRate_rf + expo_rf*superRate_rf**2 - 100*superRate_rf**2)/((superRate_rf + 100)*(expo_rf*superRate_rf - 100*superRate_rf + 10000));
                } else if (expo_otx<0){
                    rcRate = (rcRate_rf*(superRate_rf + 100)*(expo_rf*superRate_rf - 100*superRate_rf - 10000*expo_otx + 200*expo_otx*superRate_rf + 40000*expo_otx**2 - 2*expo_rf*expo_otx*superRate_rf + 10000))/(200000000*(2*expo_otx - 1)**2);
                    superRate = -(30000*expo_otx - 100*superRate_rf + expo_rf*superRate_rf + 200*expo_otx*superRate_rf - 2*expo_rf*expo_otx*superRate_rf)/(10000*(2*expo_otx - 1)**2);
                    expo = (10000*expo_rf + 1000000*expo_otx - 20000*expo_rf*expo_otx + 100*expo_rf*superRate_rf + 10000*expo_otx*superRate_rf + expo_rf*superRate_rf**2 + 200*expo_otx*superRate_rf**2 + 40000*expo_otx**2*superRate_rf + 4000000*expo_otx**2 - 100*superRate_rf**2 - 200*expo_rf*expo_otx*superRate_rf - 2*expo_rf*expo_otx*superRate_rf**2)/((superRate_rf + 100)*(expo_rf*superRate_rf - 100*superRate_rf - 10000*expo_otx + 200*expo_otx*superRate_rf + 40000*expo_otx**2 - 2*expo_rf*expo_otx*superRate_rf + 10000));
                } else {
                    rcRate = (rcRate_rf*(superRate_rf + 100)*(10000*expo_otx + 100*superRate_rf - expo_rf*superRate_rf - 10000))/(200000000*(expo_otx - 1));
                    superRate = (superRate_rf*(expo_rf - 100))/(10000*(expo_otx - 1));
                    expo = -(10000*expo_rf - 1000000*expo_otx + 100*expo_rf*superRate_rf - 10000*expo_otx*superRate_rf + expo_rf*superRate_rf**2 - 100*superRate_rf**2)/((superRate_rf + 100)*(10000*expo_otx + 100*superRate_rf - expo_rf*superRate_rf - 10000));
                }

                if (rcRate<0 || rcRate>12.6142 || superRate<0 || superRate>1 || expo<0 || expo>1){
                    return rcConvert11(rcRate_rf, expo_rf, superRate_rf, expo_otx,1);
                } else {
                    return [rcRate,superRate,expo]
                } 
            }

            var rcConvert11 = function(rcRate_rf, expo_rf, superRate_rf, expo_otx,fittype) {
                var error_1=0;
                var error_2=-1;
                var rcRate_f=1;
                var super_f=0;
                diffType=0;
                var w, dr, drmax1;
                var drmax2=-1;
                switch (fittype){
                        case '3':
                        rscale=1.1;
                        break
                        case '4':
                        rscale=2;
                        break
                        case '5':
                        rscale=2;
                        diffType=1;
                        break
                        default:
                        rscale=1.0;
                }
                
                for (var expo_i = 0.00; expo_i < 1; expo_i+=0.01){
                    
                        if (expo_otx==0){
                            rcRate_MAX = rscale*(rcRate_rf*(expo_rf - 100))/(100*(200*expo_i - 200));
                            rcRate_MIN = (2-rscale)*(rcRate_rf*(expo_rf - 100))/(100*(200*expo_i - 200));
                        } else if (expo_otx<0){
                            rcRate_MAX = -rscale*(rcRate_rf*(expo_rf - 100))/(20000*(2*expo_otx - 1)*(expo_i - 1));
                            rcRate_MIN = -(2-rscale)*(rcRate_rf*(expo_rf - 100))/(20000*(2*expo_otx - 1)*(expo_i - 1));
                        } else {
                            rcRate_MAX = -rscale*(rcRate_rf*(expo_rf - 100))/(20000*(expo_i - 1)*(expo_otx - 1));
                            rcRate_MIN = -(2-rscale)*(rcRate_rf*(expo_rf - 100))/(20000*(expo_i - 1)*(expo_otx - 1));
                        }
                        rcRate_MAX=Math.round(100*natural2StandardRcRate(rcRate_MAX))/100;
                        rcRate_MAX=clamp(rcRate_MAX,0.01,3.0);
                        rcRate_MIN=Math.round(100*natural2StandardRcRate(rcRate_MIN))/100;
                        rcRate_MIN=clamp(rcRate_MIN,0.01,rcRate_MAX);

                        for (var rcRate=rcRate_MIN; rcRate<=rcRate_MAX; rcRate+=0.01){

                            rcRate_u=amplifiedRcRate(rcRate);
                            superRate = Math.round(100*(1-(20000*rcRate_u)/(rcRate_rf*(superRate_rf + 100))))/100;

                            for (var superOffset=-0.05; superOffset<=0.12; superOffset+=0.01){
                                if (superRate+superOffset<1 && superRate+superOffset>=0){
                                    error_1=0;
                                    drmax1=0;

                                    if (diffType==0){
                                        for (var p=0.01; p<=1+.0005; p+=0.01){
                                            w=(fittype==1)?(1-p)**2/p:(1);
                                            dr=Math.abs(bfcalc(expo_otx_calc(p,expo_otx), rcRate, expo_i, superRate+superOffset)-rfcalc(p, rcRate_rf, expo_rf, superRate_rf));
                                            error_1 +=  w*dr;
                                        }
                                    } else {
                                        var dr_sgn, dr_sgn_last=0, dr_last=-1;
                                        for (var p=0.01; p<=1+.0005; p+=0.01){
                                            dr=Math.abs(bfcalc(expo_otx_calc(p,expo_otx), rcRate, expo_i, superRate+superOffset)-rfcalc(p, rcRate_rf, expo_rf, superRate_rf));
                                            if (dr>drmax1)
                                                drmax1=dr;
                                            dr_sgn=Math.sign(dr-dr_last);
                                            if (dr_last != -1 && dr_sgn_last != dr_sgn && dr_sgn == -1){
                                                for (var pp=Math.min(p-0.02+0.005,0.005); pp<Math.min(p+0.01,1); pp+=0.005){
                                                    drr=Math.abs(bfcalc(expo_otx_calc(pp,expo_otx), rcRate, expo_i, superRate+superOffset)-rfcalc(pp, rcRate_rf, expo_rf, superRate_rf));
                                                    if (drr>drmax1)
                                                        drmax1=drr;
                                                }
                                            }
                                            dr_last=dr;
                                            dr_sgn_last=dr_sgn;
                                        }
                                        /*if (Math.round(100*rcRate)/100==2.3 && Math.round(100*expo_i)/100==.8){
                                            console.log(superRate+superOffset)
                                            console.log(drmax1)
                                        }*/
                                    }

                                    if (diffType==0 && ( error_2==-1 || error_1 < error_2 )){
                                        expo=expo_i;
                                        rcRate_f=rcRate_u;
                                        super_f=superRate+superOffset;
                                        error_2=error_1;
                                    } else if (diffType==1 && (drmax2==-1 || drmax1 < drmax2)){
                                        expo=expo_i;
                                        rcRate_f=rcRate_u;
                                        super_f=superRate+superOffset;
                                        drmax2=drmax1;
                                    }
                                }
                            }
                        }
                        if (rscale==1)
                            break
                }
                
                return [rcRate_f,super_f,expo]
            }

            //Betaflight --> Race flight
            var rcConvert2 = function(rcRate, superRate, expo, expo_otx,fittype) {

                rcRate=amplifiedRcRate(rcRate);
                superRate=clamp(superRate,0.000001,1);

                if (expo_otx==0){
                    rcRate_rf = -(100*rcRate*(expo + superRate - expo*superRate + ((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) - 1))/(superRate*(superRate - 1));
                    superRate_rf = (50*expo + 50*superRate - 50*expo*superRate + 50*((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) - 50)/((expo - 1)*(superRate - 1));
                    expo_rf = 50*expo + 50*superRate - 50*expo*superRate - 50*((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) + 50;
                } else if (expo_otx<0){
                    rcRate_rf = (100*rcRate*(2*expo_otx - 1)*(expo + 2*expo_otx + superRate - 2*expo*expo_otx - expo*superRate - 2*expo_otx*superRate + ((expo - 1)*(superRate - 1)*(8*expo_otx - expo + 3*superRate + 4*expo*expo_otx + expo*superRate - 12*expo_otx*superRate - 4*expo*expo_otx**2 + 12*expo_otx**2*superRate + 4*expo_otx**2 - 4*expo*expo_otx*superRate + 4*expo*expo_otx**2*superRate + 1))**(1/2) + 2*expo*expo_otx*superRate - 1))/((superRate - 1)*(3*expo_otx + superRate - 4*expo_otx*superRate + 4*expo_otx**2*superRate));
                    superRate_rf = -(50*expo + 100*expo_otx + 50*superRate - 100*expo*expo_otx - 50*expo*superRate - 100*expo_otx*superRate + 50*((expo - 1)*(superRate - 1)*(8*expo_otx - expo + 3*superRate + 4*expo*expo_otx + expo*superRate - 12*expo_otx*superRate - 4*expo*expo_otx**2 + 12*expo_otx**2*superRate + 4*expo_otx**2 - 4*expo*expo_otx*superRate + 4*expo*expo_otx**2*superRate + 1))**(1/2) + 100*expo*expo_otx*superRate - 50)/((2*expo_otx - 1)*(expo - 1)*(superRate - 1));
                    expo_rf = 50*expo + 100*expo_otx + 50*superRate - 100*expo*expo_otx - 50*expo*superRate - 100*expo_otx*superRate - 50*((expo - 1)*(superRate - 1)*(8*expo_otx - expo + 3*superRate + 4*expo*expo_otx + expo*superRate - 12*expo_otx*superRate - 4*expo*expo_otx**2 + 12*expo_otx**2*superRate + 4*expo_otx**2 - 4*expo*expo_otx*superRate + 4*expo*expo_otx**2*superRate + 1))**(1/2) + 100*expo*expo_otx*superRate + 50;
                } else {
                    rcRate_rf = -(100*rcRate*(expo + superRate - expo*superRate + ((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) - 1))/(superRate*(superRate - 1));
                    superRate_rf = (50*expo + 50*superRate - 50*expo*superRate + 50*((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) - 50)/((expo - 1)*(superRate - 1));
                    expo_rf = 50*expo + 50*expo_otx + 50*superRate - 50*expo*expo_otx - 50*expo*superRate - 50*expo_otx*superRate + 50*expo_otx*((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) - 50*((expo - 1)*(superRate - 1)*(3*superRate - expo + expo*superRate + 1))**(1/2) + 50*expo*expo_otx*superRate + 50;
                }

                if (rcRate_rf<=0 || rcRate_rf>2500 || superRate_rf<0 || expo_rf<0 || expo_rf>100){
                    return rcConvert22(rcRate_rf, expo_rf, superRate_rf, expo_otx,1);
                } else {
                    return [rcRate_rf,superRate_rf,expo_rf]
                }

            }

            var rcConvert22 = function(rcRate, superRate, expo, expo_otx,fittype) {

                rcRate_u=amplifiedRcRate(rcRate);
                superRate=clamp(superRate,0.000001,1);

                var error_1=0;
                var error_2=-1;
                var rcRate_rf_f=1;
                var super_f=0;
                diffType=0;
                var w, dr, drmax1;
                var drmax2=-1;
                
                
                switch (fittype){
                        case '3':
                        rscale=1.1;
                        break
                        case '4':
                        rscale=2;
                        break
                        case '5':
                        rscale=2;
                        diffType=1;
                        break
                        default:
                        rscale=1.0;
                }
                
                
                for (var expo_rf_i = 0.00; expo_rf_i < 100; expo_rf_i+=1){

                    if (expo_otx==0){
                        rcRate_rf_MAX = rscale*(20000*rcRate_u*(expo - 1))/(expo_rf_i - 100);
                        rcRate_rf_MIN = (2-rscale)*(20000*rcRate_u*(expo - 1))/(expo_rf_i - 100);
                    } else if (expo_otx<0){
                        rcRate_rf_MAX = -rscale*(20000*rcRate_u*(2*expo_otx - 1)*(expo - 1))/(expo_rf_i - 100);
                        rcRate_rf_MIN = -(2-rscale)*(20000*rcRate_u*(2*expo_otx - 1)*(expo - 1))/(expo_rf_i - 100);
                    } else {
                        rcRate_rf_MAX = -rscale*(20000*rcRate_u*(expo - 1)*(expo_otx - 1))/(expo_rf_i - 100);
                        rcRate_rf_MIN = -(2-rscale)*(20000*rcRate_u*(expo - 1)*(expo_otx - 1))/(expo_rf_i - 100);
                    }
                    rcRate_rf_MAX=Math.round(clamp(rcRate_rf_MAX,1,2500));
                    rcRate_rf_MIN=Math.round(clamp(rcRate_rf_MIN,1,rcRate_rf_MAX));
                    
                    for (var rcRate_rf=rcRate_rf_MIN; rcRate_rf<=rcRate_rf_MAX; rcRate_rf+=1){
                        
                        superRate_rf = Math.round(-(100*(rcRate_rf + (200*rcRate_u)/(superRate - 1)))/rcRate_rf);

                        for (var superOffset=-14; superOffset<=5; superOffset+=1){
                            if (superRate_rf+superOffset>0){
                                error_1=0;
                                drmax1=0;
                                if (diffType==0){
                                    for (var p=0.01; p<=1+.0005; p+=0.01){
                                        w=(fittype==1)?(1-p)**2/p:(1);
                                        dr=Math.abs(bfcalc(expo_otx_calc(p,expo_otx), rcRate, expo, superRate)-rfcalc(p, rcRate_rf, expo_rf_i, superRate_rf+superOffset));
                                        error_1 +=  w*dr;
                                    }
                                } else {
                                    var dr_sgn, dr_sgn_last=0, dr_last=-1;
                                    for (var p=0.01; p<=1+.0005; p+=0.01){
                                        dr=Math.abs(bfcalc(expo_otx_calc(p,expo_otx), rcRate, expo, superRate)-rfcalc(p, rcRate_rf, expo_rf_i, superRate_rf+superOffset));
                                        if (dr>drmax1)
                                            drmax1=dr;
                                        dr_sgn=Math.sign(dr-dr_last);
                                        if (dr_last != -1 && dr_sgn_last != dr_sgn && dr_sgn == -1){
                                            for (var pp=p-0.02+0.005; pp<p+0.01; pp+=0.005){
                                                drr=Math.abs(bfcalc(expo_otx_calc(pp,expo_otx), rcRate, expo, superRate)-rfcalc(pp, rcRate_rf, expo_rf_i, superRate_rf+superOffset));
                                                if (drr>drmax1)
                                                    drmax1=drr;
                                            }
                                        }
                                        dr_last=dr;
                                        dr_sgn_last=dr_sgn;
                                    }
                                    /*if (expo_rf_i==66 && superRate_rf+superOffset == 114 && rcRate_rf==631){
                                        console.log(rcRate)
                                        console.log(drmax1)
                                    }*/
                                }
                                if (diffType==0 && ( error_2==-1 || error_1 < error_2 )){
                                    expo_rf=expo_rf_i;
                                    rcRate_rf_f=rcRate_rf;
                                    super_f=superRate_rf+superOffset;
                                    error_2=error_1;
                                } else if (diffType==1 && (drmax2==-1 || drmax1 < drmax2)){
                                    expo_rf=expo_rf_i;
                                    rcRate_rf_f=rcRate_rf;
                                    super_f=superRate_rf+superOffset;
                                    drmax2=drmax1;
                                }
                            }

                        }
                        if (rscale==1)
                            break
                    }
                }

                return [rcRate_rf_f,super_f,expo_rf]
            }

            //Open TX expo function
            var expo_otx_calc = function(rcCommand, expo_otx){
                if(expo_otx < 0){
                    rcCommand = 1+expo_otx*(1-rcCommand)**3-(1-rcCommand)*(1+expo_otx)
                } else if(expo_otx > 0){
                    rcCommand = expo_otx*rcCommand**3+rcCommand*(1-expo_otx)
                }
                return rcCommand
            }

            var updateRcRateNaturalScaling = function(expo_otx, Slope, Maxdeg, Shape){
                if (Maxdeg==0)
                    return 0
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                minRcRate=Slope/kotx;
                maxRcRate=Maxdeg/200;
                rcRate = minRcRate*Shape+(1-Shape)*maxRcRate;
                return rcRate
            }

            var natural2StandardRcRate = function(rcRate){
                if (rcRate>2){
                    rcRate=2+(rcRate-2)/15.54;
                }
                return Math.round(100*rcRate)/100;
            }

            var unAmplifiedRcRate = function(rcRate){
                if(rcRate > 2.0)
                    rcRate = (50*rcRate)/777 + 1454/777;
                return Math.round(100*rcRate)/100
            }

            var amplifiedRcRate = function(rcRate){
                if(rcRate > 2.0)
                    rcRate =rcRate+(rcRate-2)*14.54;
                return rcRate
            }

            var updateSuperRate = function(rcRate,Maxdeg){
                //must be real rcRate
                superRate = Math.max(0,1-200*rcRate/Maxdeg);
                return Math.round(100*superRate)/100
            }

            var updateExpo = function(rcRate,expo_otx,Slope){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                expo = 1-Slope/(rcRate*kotx);
                return Math.round(100*expo)/100
            }

            var updateExpo_otx = function(rcRate,expo,Slope){
                //must be real rcRate
                expo_otx = 1-Slope/(rcRate*(1-expo));
                expo_otx = (expo_otx>0)?(expo_otx):(0.5*expo_otx);
                return Math.round(100*expo_otx)/100
            }

            var updateSlope = function(rcRate,expo,expo_otx){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                Slope = rcRate*(1-expo)*kotx;
                return Slope
            }

            var updateMaxdeg = function(rcRate,superRate){
                //must be real rcRate
                Maxdeg = rcRate*200/(1-superRate);
                return Maxdeg
            }

            var updateShape = function(rcRate,expo_otx,Slope,Maxdeg){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                minRcRate=Slope/kotx;
                maxRcRate=Maxdeg/200;
                Shape =(rcRate-maxRcRate)/(minRcRate-maxRcRate);
                return Shape
            }

            var checkboxCallback = function(){
                if(checkBox.checked){
                    $('#Slope2').hide();
                    $('#SlopeSlider2').hide();
                    $('#pitchValue').show().text($('#Slope1').val().toString());
                    $('#pitchValueSlider').show();
                    $('#otxNegExpo2').hide();
                    $('#otxNegExpoSlider2').hide();
                    $('#otxValue').show().text($('#otxNegExpo1').val().toString());
                } else {
                    $('#Slope2').show().val($('#Slope2').val()).change();
                    $('#SlopeSlider2').show().val($('#Slope2').val()).change();
                    $('#pitchValue').hide();
                    $('#pitchValueSlider').hide();
                    $('#otxNegExpo2').show().val($('#otxNegExpo1').val()).change();;
                    $('#otxNegExpoSlider2').show().val($('#otxNegExpo1').val()).change();
                    $('#otxValue').hide();
                }
                return null
            }

            var setRates = function(a){
                if(a[0]==0){
                    checkBox.checked=false;
                } else {
                    checkBox.checked=true;
                }
                checkboxCallback();
                $('#bfRate1').val(a[1]).change();
                $('#bfSuper1').val(a[2]).change();
                $('#bfExpo1').val(a[3]).change();
                $('#otxNegExpo1').val(a[4]).change();
                $('#bfSuper2').val(a[5]).change();
                $('#otxNegExpo2').val(a[6]).change();
                $('#bfRate3').val(a[7]).change();
                $('#bfSuper3').val(a[8]).change();
                $('#bfExpo3').val(a[9]).change();
                $('#otxNegExpo3').val(a[10]).change();
                return null
            }

            function drawChart(update) {

                doDraw=false;

                if (update==1){
                    //update tuning inputs/sliders
                    //(1 get input value, 2 update local sliders, 3 calc, 4 update calc'd inputs&sliders)

                    //Roll.1
                    Slope1 = clamp(parseFloat($('#Slope1').val(), 10),0,3.16);
                    Maxdeg1 = clamp(parseFloat($('#Maxdeg1').val(), 10),0,3001);
                    Shape1 = clamp(parseFloat($('#Shape1').val(), 10),0,1);
                    otxNegExpo1 = clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999);
                    //Roll.2
                    $('#SlopeSlider1').val(Slope1).change();
                    $('#MaxdegSlider1').val(Maxdeg1).change();
                    $('#ShapeSlider1').val(Shape1).change();
                    $('#otxNegExpoSlider1').val(otxNegExpo1).change();
                    //Roll.3,4
                    rc = updateRcRateNaturalScaling(otxNegExpo1, Slope1, Maxdeg1, Shape1);
                    $('#bfRate1').val(clamp(natural2StandardRcRate(rc),0,2.40)).change();
                    $('#bfExpo1').val(clamp(updateExpo(rc,otxNegExpo1,Slope1),-0.01,1)).change();
                    $('#bfSuper1').val(clamp(updateSuperRate(rc,Maxdeg1),0,1)).change();
                    $('#bfRateSlider1').val(clamp(natural2StandardRcRate(rc),0,2.40)).change();
                    $('#bfExpoSlider1').val(clamp(updateExpo(rc,otxNegExpo1,Slope1),-0.01,1)).change();
                    $('#bfSuperSlider1').val(clamp(updateSuperRate(rc,Maxdeg1),0,1)).change();

                    //Pitch.1
                    if(checkBox.checked){
                        Slope2 = Slope1;
                        $('#pitchValue').text($('#Slope1').val().toString());
                        otxNegExpo2 = otxNegExpo1;
                        $('#otxValue').text($('#otxNegExpo1').val().toString());
                    } else {
                        Slope2 = clamp(parseFloat($('#Slope2').val(), 10),0,3.16);
                        otxNegExpo2 = clamp(-Slope2/(rc*(1-parseFloat($('#bfExpo1').val(), 10)))/2+0.5,-1,0.999);
                        if(otxNegExpo2>0)
                            otxNegExpo2=2*otxNegExpo2;
                    }
                    
                    Maxdeg2 = clamp(parseFloat($('#Maxdeg2').val(), 10),0,3001);
                    //Shape2 = clamp((rc-Maxdeg2/200)/(Slope2-Maxdeg2/200),0,1);
                    
                    //Pitch.2
                    $('#SlopeSlider2').val(Slope2).change();
                    $('#MaxdegSlider2').val(Maxdeg2).change();
                    $('#otxNegExpoSlider2').val(otxNegExpo2).change();
                    //Pitch.3,4
                    $('#bfSuper2').val(clamp(updateSuperRate(rc,Maxdeg2),0,1)).change();
                    $('#bfSuperSlider2').val(clamp(updateSuperRate(rc,Maxdeg2),0,1)).change();
                    $('#otxNegExpo2').val(Math.round(100*otxNegExpo2)/100).change();

                    //Yaw.1
                    Slope3 = clamp(parseFloat($('#Slope3').val(), 10),0,3.16);
                    Maxdeg3 = clamp(parseFloat($('#Maxdeg3').val(), 10),0,3001);
                    Shape3 = clamp(parseFloat($('#Shape3').val(), 10),0,1);
                    otxNegExpo3 = clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999);
                    //Yaw.2
                    $('#SlopeSlider3').val(Slope3).change();
                    $('#MaxdegSlider3').val(Maxdeg3).change();
                    $('#ShapeSlider3').val(Shape3).change();
                    $('#otxNegExpoSlider3').val(otxNegExpo3).change();
                    //Yaw.3,4
                    rc = updateRcRateNaturalScaling(otxNegExpo3, Slope3, Maxdeg3, Shape3);
                     $('#bfRate3').val(clamp(natural2StandardRcRate(rc),0,2.40)).change();
                     $('#bfExpo3').val(clamp(updateExpo(rc,otxNegExpo3,Slope3),-0.01,1)).change();
                     $('#bfSuper3').val(clamp(updateSuperRate(rc,Maxdeg3),0,1)).change();
                     $('#bfRateSlider3').val(clamp(natural2StandardRcRate(rc),0,2.40)).change();
                     $('#bfExpoSlider3').val(clamp(updateExpo(rc,otxNegExpo3,Slope3),-0.01,1)).change();
                     $('#bfSuperSlider3').val(clamp(updateSuperRate(rc,Maxdeg3),0,1)).change();

                }

                bfRate1 = clamp(parseFloat($('#bfRate1').val(), 10),0,2.40);
                bfExpo1 = clamp(parseFloat($('#bfExpo1').val(), 10),-0.01,1);
                bfSuper1 = clamp(parseFloat($('#bfSuper1').val(), 10),0,1);
                otxNegExpo1 = clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999);

                bfSuper2 = clamp(parseFloat($('#bfSuper2').val(), 10),0,1);
                if(checkBox.checked){
                    otxNegExpo2 = otxNegExpo1;
                    $('#otxValue').text($('#otxNegExpo1').val().toString());
                } else {
                    otxNegExpo2 = clamp(parseFloat($('#otxNegExpo2').val(), 10),-1,0.999);
                }

                bfRate3 = clamp(parseFloat($('#bfRate3').val(), 10),0,2.40);
                bfExpo3 = clamp(parseFloat($('#bfExpo3').val(), 10),-0.01,1);
                bfSuper3 = clamp(parseFloat($('#bfSuper3').val(), 10),0,1);
                otxNegExpo3 = clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999);

                if (update==0 || update==undefined){
                    //update configurator inputs/sliders
                    //(1 get input value, 2 update local sliders, 3 calc, 4 update calc'd inputs&sliders)

                    //Roll.1 (above)
                    //Roll.2
                    $('#bfRateSlider1').val(bfRate1).change();
                    $('#bfExpoSlider1').val(bfExpo1).change();
                    $('#bfSuperSlider1').val(bfSuper1).change();
                    $('#otxNegExpoSlider1').val(otxNegExpo1).change();
                    //Roll.3
                    rc = clamp(amplifiedRcRate(bfRate1),0,4);
                    slp=clamp(updateSlope(rc,bfExpo1,otxNegExpo1),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper1),0,3001);
                    shp=clamp(updateShape(rc,otxNegExpo1,slp,mxdeg),0,1);
                    //Roll.4
                    $('#Slope1').val(Math.round(200*slp)/200).change();
                    $('#Maxdeg1').val(Math.round(mxdeg)).change();
                    $('#Shape1').val(Math.round(1000*shp)/1000).change();
                    $('#SlopeSlider1').val(slp).change();
                    $('#MaxdegSlider1').val(mxdeg).change();
                    $('#ShapeSlider1').val(shp).change();
                   
                    //Pitch.1 (above)
                    //Pitch.2
                    $('#bfSuperSlider2').val(bfSuper2).change();
                    $('#otxNegExpoSlider2').val(otxNegExpo2).change();
                    if(checkBox.checked){
                        $('#otxValue').show().text($('#otxNegExpo1').val().toString());
                    }
                    //Pitch.3
                    slp=clamp(updateSlope(rc,bfExpo1,otxNegExpo2),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper2),0,3001);
                    //shp=updateShape(rc,otxNegExpo2,slp,mxdeg);
                    //Pitch.4
                    $('#Slope2').val(Math.round(200*slp)/200).change();
                    if(checkBox.checked){
                        $('#pitchValue').show().text($('#Slope2').val().toString());
                    }
                    $('#Maxdeg2').val(Math.round(mxdeg)).change();
                    $('#SlopeSlider2').val(slp).change();
                    $('#MaxdegSlider2').val(mxdeg).change();

                    //Yaw.1 (above)
                    //Yaw.2
                    $('#bfRateSlider3').val(bfRate3).change();
                    $('#bfExpoSlider3').val(bfExpo3).change();
                    $('#bfSuperSlider3').val(bfSuper3).change();
                    $('#otxNegExpoSlider3').val(otxNegExpo3).change();
                    //Yaw.3
                    rc = clamp(amplifiedRcRate(bfRate3),0,4);
                    slp=clamp(updateSlope(rc,bfExpo3,otxNegExpo3),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper3),0,3001);
                    shp=clamp(updateShape(rc,otxNegExpo3,slp,mxdeg),0,1);
                    //Yaw.4
                    $('#Slope3').val(Math.round(200*slp)/200).change();
                    $('#Maxdeg3').val(Math.round(mxdeg)).change();
                    $('#Shape3').val(Math.round(1000*shp)/1000).change();
                    $('#SlopeSlider3').val(slp).change();
                    $('#MaxdegSlider3').val(mxdeg).change();
                    $('#ShapeSlider3').val(shp).change();


                }


                var ratesData = [];

                var data = new google.visualization.DataTable();
				data.addColumn('number', 'Stick Input');
                data.addColumn('number', 'ROLL');
                data.addColumn('number', 'PITCH');
                data.addColumn('number', 'YAW');
                if (showRf){
                    data.addColumn('number', 'RF');
                }

                var stickEnd=1.0;
                var stickIter=0.01;
                if (checkOptions[0].checked) {
                    var stickEnd=0.5;
                    var stickIter=0.005;
                }

                //Turn super rate red if negative expo is causing a non-increasing slope
                //(user should increase super)
                if (otxNegExpo1<0 && bfSuper1 < -3*otxNegExpo1/(1-2*otxNegExpo1)/(1-2*otxNegExpo1)){
                    $('#bfSuper1').css('color','red');
                } else {
                    $('#bfSuper1').css('color','inherit');
                }

                if (otxNegExpo2<0 && bfSuper2 < -3*otxNegExpo2/(1-2*otxNegExpo2)/(1-2*otxNegExpo2)){
                    $('#bfSuper2').css('color','red');
                } else {
                    $('#bfSuper2').css('color','inherit');
                }

                if (otxNegExpo3<0 && bfSuper3 < -3*otxNegExpo3/(1-2*otxNegExpo3)/(1-2*otxNegExpo3)){
                    $('#bfSuper3').css('color','red');
                } else {
                    $('#bfSuper3').css('color','inherit');
                }
                    
                if (checkOptions[1].checked){
                    //derivative
                    for (var i = 0; i <= stickEnd; i+=stickIter) {
                        if (showRf){
                            data.addRow([
                                i,
                                bfD1(i+stickIter, bfRate1, bfExpo1, bfSuper1,otxNegExpo1)/200,
                                bfD1(i+stickIter, bfRate1, bfExpo1, bfSuper2,otxNegExpo2)/200,
                                bfD1(i+stickIter, bfRate3, bfExpo3, bfSuper3, otxNegExpo3)/200,
                                rfD1(i+stickIter, rfRateSet[0], rfRateSet[1], rfRateSet[2])/200
                            ]);
                        } else {
                            data.addRow([
                                i,
                                bfD1(i+stickIter, bfRate1, bfExpo1, bfSuper1,otxNegExpo1)/200,
                                bfD1(i+stickIter, bfRate1, bfExpo1, bfSuper2,otxNegExpo2)/200,
                                bfD1(i+stickIter, bfRate3, bfExpo3, bfSuper3, otxNegExpo3)/200
                            ]);
                        }
                    }
                } else if (checkOptions[2].checked){
                    //2nd derivative
                    for (var i = 0; i <= stickEnd; i+=stickIter) {
                        if (showRf){
                            data.addRow([
                                i,
                                bfD2(i+stickIter, bfRate1, bfExpo1, bfSuper1,otxNegExpo1)/200,
                                bfD2(i+stickIter, bfRate1, bfExpo1, bfSuper2,otxNegExpo2)/200,
                                bfD2(i+stickIter, bfRate3, bfExpo3, bfSuper3, otxNegExpo3)/200,
                                rfD2(i+stickIter, rfRateSet[0], rfRateSet[1], rfRateSet[2])/200
                            ]);
                        } else {
                            data.addRow([
                                i,
                                bfD2(i+stickIter, bfRate1, bfExpo1, bfSuper1,otxNegExpo1)/200,
                                bfD2(i+stickIter, bfRate1, bfExpo1, bfSuper2,otxNegExpo2)/200,
                                bfD2(i+stickIter, bfRate3, bfExpo3, bfSuper3, otxNegExpo3)/200
                            ]);
                        }
                    }
                } else {
                    //rates
                    for (var i = 0; i <= stickEnd; i+=stickIter) {
                        if (showRf){
                            data.addRow([
                                i,
                                bfcalc(expo_otx_calc(i,otxNegExpo1), bfRate1, bfExpo1, bfSuper1),
                                bfcalc(expo_otx_calc(i,otxNegExpo2), bfRate1, bfExpo1, bfSuper2),
                                bfcalc(expo_otx_calc(i,otxNegExpo3), bfRate3, bfExpo3, bfSuper3),
                                rfcalc(i, rfRateSet[0], rfRateSet[1], rfRateSet[2])
                            ]);
                        } else {
                            data.addRow([
                                i,
                                bfcalc(expo_otx_calc(i,otxNegExpo1), bfRate1, bfExpo1, bfSuper1),
                                bfcalc(expo_otx_calc(i,otxNegExpo2), bfRate1, bfExpo1, bfSuper2),
                                bfcalc(expo_otx_calc(i,otxNegExpo3), bfRate3, bfExpo3, bfSuper3)
                            ]);
                        }
                    }
                }

                var options = {
                    width: 900,
                    height: 600,
                    titlePosition: 'none',
                    curveType: 'function',
                    legend: {
                        position: 'bottom',
                        textStyle: {color: "#888"}
                    },
                    backgroundColor: { fill:'transparent' },
                    hAxis: {
                        baselineColor: "#888",
                        gridlines: {color: "#888"},
                        textStyle: {color: "#888"}
                    },
                    vAxis: {
                        baselineColor: "#888",
                        gridlines: {color: "#888"},
                        textStyle: {color: "#888"}
                    }
                };

                var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

                chart.draw(data, options);

                doDraw = true;
            }

            var showHelp = function(){
                $('#help').show();
                $('#showHelp').hide();
                $('#hideHelp').show();
            }

            var hideHelp = function(){
                $('#help').hide();
                $('#showHelp').show();
                $('#hideHelp').hide();
            }

            var showRfRates = function(){
                $('#rfRates').show();
                $('#showRfRates').hide();
                $('#hideRfRates').show();
            }

            var hideRfRates = function(){
                $('#rfRates').hide();
                $('#showRfRates').show();
                $('#hideRfRates').hide();
            }

            //Convert rates
            var convertRoll = function(){
                var curveFunc;
                var fittype=$('#r2b')[0].value;
                if (fittype==0){
                    curveFunc=rcConvert1;
                } else {
                    curveFunc=rcConvert11;
                }
                toBf = curveFunc(rfRateSet[0], rfRateSet[1], rfRateSet[2], clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999),fittype);
                $('#bfRate1').val(clamp(natural2StandardRcRate(toBf[0]),0,2.40)).change();
                $('#bfExpo1').val(clamp(Math.round(toBf[2]*100)/100,-0.01,1)).change();
                $('#bfSuper1').val(clamp(Math.round(toBf[1]*100)/100,0,1)).change();
                $('#bfRateSlider1').val(clamp(natural2StandardRcRate(toBf[0]),0,2.40)).change();
                $('#bfExpoSlider1').val(clamp(toBf[2],-0.01,1)).change();
                $('#bfSuperSlider1').val(clamp(toBf[1],0,1)).change();
                drawChart(0);
            }

            var convertYaw = function(){
                var curveFunc;
                var fittype=$('#r2b')[0].value;
                if (fittype==0){
                    curveFunc=rcConvert1;
                } else {
                    curveFunc=rcConvert11;
                }
                toBf = curveFunc(rfRateSet[0], rfRateSet[1], rfRateSet[2], clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999),fittype);
                $('#bfRate3').val(clamp(natural2StandardRcRate(toBf[0]),0,2.40)).change();
                $('#bfExpo3').val(clamp(Math.round(toBf[2]*100)/100,-0.01,1)).change();
                $('#bfSuper3').val(clamp(Math.round(toBf[1]*100)/100,0,1)).change();
                $('#bfRateSlider3').val(clamp(natural2StandardRcRate(toBf[0]),0,2.40)).change();
                $('#bfExpoSlider3').val(clamp(toBf[2],-0.01,1)).change();
                $('#bfSuperSlider3').val(clamp(toBf[1],0,1)).change();
                drawChart(0);
            } 

            //to raceflight
            var convertRoll2RF = function(){
                var curveFunc;
                var fittype=$('#b2r')[0].value;
                if (fittype==0){
                    curveFunc=rcConvert2;
                } else {
                    curveFunc=rcConvert22;
                }
                toRf = curveFunc(parseFloat($('#bfRate1').val(), 10), parseFloat($('#bfSuper1').val(), 10), parseFloat($('#bfExpo1').val(), 10), clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999),fittype);
                $('#rfRate').val(Math.round(toRf[0])).change();
                $('#rfSuper').val(Math.round(toRf[1])).change();
                $('#rfExpo').val(Math.round(toRf[2])).change();
                drawChart(0);
            }

            var convertYaw2RF = function(){
                var curveFunc;
                var fittype=$('#b2r')[0].value;
                if (fittype==0){
                    curveFunc=rcConvert2;
                } else {
                    curveFunc=rcConvert22;
                }
                toRf = curveFunc(parseFloat($('#bfRate3').val(), 10), parseFloat($('#bfSuper3').val(), 10), parseFloat($('#bfExpo3').val(), 10), clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999),fittype);
                $('#rfRate').val(Math.round(toRf[0])).change();
                $('#rfSuper').val(Math.round(toRf[1])).change();
                $('#rfExpo').val(Math.round(toRf[2])).change();
                drawChart(0);
            }

            //fit error calc
            var rollError = function(dp){
                if (!dp)
                    dp=.0005;
                var errorSum=0
                var error_i;
                var rcRate=parseFloat($('#bfRate1').val(), 10);
                var expo=parseFloat($('#bfExpo1').val(), 10);
                var superRate=parseFloat($('#bfSuper1').val(), 10);
                var expo_otx=clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999);

                max_error=0;
                for (var p=0.0; p<=1; p+=dp){
                    error_i =  Math.abs(bfcalc(expo_otx_calc(p,expo_otx),rcRate , expo, superRate)-rfcalc(p, rfRateSet[0], rfRateSet[1], rfRateSet[2]));
                    errorSum += error_i;
                    if (error_i>max_error)
                        max_error=error_i;
                }
                if (dp==.0005){
                    console.log('Average error over 2000 pts:')
                    console.log(errorSum*dp)
                    console.log('Maximum error over 2000 pts:')
                    console.log(max_error)
                }
                return max_error
            }

            var yawError = function(dp){
                if (!dp)
                    dp=.0005;
                var errorSum=0
                var error_i;
                var rcRate=parseFloat($('#bfRate3').val(), 10);
                var expo=parseFloat($('#bfExpo3').val(), 10);
                var superRate=parseFloat($('#bfSuper3').val(), 10);
                var expo_otx=clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999);

                max_error=0;
                for (var p=0.0; p<=1; p+=dp){
                    error_i =  Math.abs(bfcalc(expo_otx_calc(p,expo_otx), rcRate , expo, superRate)-rfcalc(p, rfRateSet[0], rfRateSet[1], rfRateSet[2]));
                    errorSum += error_i;
                    if (error_i>max_error)
                        max_error=error_i;
                }
                if (dp==.0005){
                    console.log('Average error over 2000 pts:')
                    console.log(errorSum/2000)
                    console.log('Maximum error over 2000 pts:')
                    console.log(max_error)
                }
                return max_error
            }

            $( document ).ready(function() {
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawChart);
                //callbacks

                //sliders, configurator
                $('#bfRateSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfRate1').val(this.value).change();
                });
                $('#bfExpoSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfExpo1').val(this.value).change();
                });
                $('#bfSuperSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfSuper1').val(this.value).change();
                });
                $('#otxNegExpoSlider1').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo1').val(this.value).change();
                });

                $('#bfSuperSlider2').on('input', function() {
                    if (doDraw)
                        $('#bfSuper2').val(this.value).change();
                });
                $('#otxNegExpoSlider2').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo2').val(this.value).change();
                });

                $('#bfRateSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfRate3').val(this.value).change();
                });
                $('#bfExpoSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfExpo3').val(this.value).change();
                });
                $('#bfSuperSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfSuper3').val(this.value).change();
                });
                $('#otxNegExpoSlider3').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo3').val(this.value).change();
                });

                //sliders, tuning
                $('#SlopeSlider1').on('input', function() {
                    if (doDraw)
                        $('#Slope1').val(this.value).change();
                });
                $('#MaxdegSlider1').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg1').val(this.value).change();
                });
                $('#ShapeSlider1').on('input', function() {
                    if (doDraw)
                        $('#Shape1').val(this.value).change();
                });

                $('#SlopeSlider2').on('input', function() {
                    if (doDraw)
                        $('#Slope2').val(this.value).change();
                });
                $('#MaxdegSlider2').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg2').val(this.value).change();
                });

                $('#SlopeSlider3').on('input', function() {
                    if (doDraw)
                        $('#Slope3').val(this.value).change();
                });
                $('#MaxdegSlider3').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg3').val(this.value).change();
                });
                $('#ShapeSlider3').on('input', function() {
                    if (doDraw)
                        $('#Shape3').val(this.value).change();
                });

                //lock checkbox
                checkBox = document.getElementById("lock");

                $(checkBox).on('change',function(evt){
                    $(evt.target).parent().css('color','blue');
                    checkboxCallback();
                    drawChart(0);
                });

                $('#rf')[0].checked=false;
                $('#rf').on('change',function(){
                    if (showRf){
                        showRf=false;
                    } else {
                        showRf=true;
                    }
                    rfRateSet[0]=parseFloat($('#rfRate').val(),10);
                    rfRateSet[1]=parseFloat($('#rfExpo').val(),10);
                    rfRateSet[2]=parseFloat($('#rfSuper').val(),10);
                    drawChart(0);
                });
                $('#rfRate,#rfExpo,#rfSuper').on('change',function(){
                    rfRateSet[0]=parseFloat($('#rfRate').val(),10);
                    rfRateSet[1]=parseFloat($('#rfExpo').val(),10);
                    rfRateSet[2]=parseFloat($('#rfSuper').val(),10);
                    drawChart(0);
                })

                checkBox.checked=true;
                checkboxCallback();

                //options checkbox
                checkOptions[0] = document.getElementById("zoom50");
                checkOptions[1] = document.getElementById("deriv");
                checkOptions[2] = document.getElementById("deriv2");

                $(checkOptions).on('change',function(evt){
                    $(checkOptions).not(evt.target).prop('checked',false);
                    $(checkOptions).parent().removeAttr('style');
                    if(evt.target.checked){
                        $(evt.target).parent().css('color','blue');
                    }
                        
                    drawChart(0);
                });
                $(checkOptions).prop('checked',false);

                //draw
                $(".input-field").on("change paste enter keyup", function() {
                    if (doDraw)
                        drawChart(0);
                });
                $(".input-field-tuning").on("change paste enter keyup", function() {
                    if (doDraw)
                        drawChart(1);
                });

                $('#pilots').on('change', function() {
                    doDraw=false;
                    $('#rate_choices').find('span').hide();
                    switch (this.value){
                        case '1': //default
                        $('#value1').show();
                        setRates( 
                            [1,
                            1.0,0.7,0,0,
                            0.7,0,
                            1.0,0.7,0,0]);
                        break
                        case '2': //holdox
                        $('#value2').show();
                        setRates( 
                            [1,
                            2.04,0,0.45,0,
                            0,0,
                            2.04,0,0.61,0]);
                        break
                        case '30': //sfpv old
                        $('#value30').show();
                        setRates( 
                            [1,
                            0.86,0.63,0.0,0,
                            0.63,0,
                            0.73,0.50,0.00,0]);
                        break
                        case '3': //sfpv new
                        $('#value3').show();
                        setRates( 
                            [1,
                            1.75,0.38,0.47,0,
                            0.38,0,
                            1.27,0.43,0.04,0]);
                        break
                        case '4': //hoopes
                        $('#value4').show();
                        setRates( 
                            [1,
                            0.8,0.66,0,0,
                            0.64,0,
                            0.8,0.61,0,0]);
                        break

                        case '5': //minchan (converted)
                        $('#value5').show();
                        setRates( 
                            [1,
                            .94,0.67,0.02,0,
                            0.67,0,
                            0.89,0.47,0.15,0]);
                        break

                        case '6': //vanover (converted)
                        $('#value6').show();
                        setRates( 
                            [1,
                            1.04,0.67,0.00,0,
                            0.67,0,
                            1.04,0.67,0.00,0]);
                        break

                        case '7': //headsup fpv
                        $('#value7').show();
                        setRates( 
                            [1,
                            0.8,0.7,0.00,0,
                            0.7,0,
                            0.8,0.7,0.00,0]);
                        break

                        case '8': //Nytfury FPV
                        $('#value8').show();
                        setRates( 
                            [1,
                            0.92,0.56,0.28,0,
                            0.56,0,
                            0.63,0.39,0.07,0]);
                        break

                        /*case '100': //my rates
                        $('#value100').show();
                        setRates( 
                            [0,
                            1.59,0.40,0.5,-0.3, 
                            0.36,-.26,
                            0.86,0.59,0.2,-0.3]);*/
                        /*case '100': //my rates
                        $('#value100').show();
                        setRates( 
                            [0,
                            1.62,0.41,0.48,-0.25, 
                            0.37,-.21,
                            0.78,0.56,0.2,-0.3]);*/
                        /*case '100': //my rates
                        $('#value100').show();
                        setRates( 
                            [0,
                            1.11,0.59,0.25,-0.25, 
                            0.56,-.21,
                            0.63,0.65,0.03,-0.25]);*/
                        case '100': //my rates
                        $('#value100').show();
                        setRates( 
                            [0,
                            1.12,0.59,0.25,-0.25, 
                            0.56,-.21,
                            0.92,0.34,0.18,-0.25]);
                    }
                        doDraw=true;
                        drawChart();
                    });

                    rfRateSet[0]=parseFloat($('#rfRate').val(),10);
                    rfRateSet[1]=parseFloat($('#rfExpo').val(),10);
                    rfRateSet[2]=parseFloat($('#rfSuper').val(),10);

                });

            </script>
    </head>
    <body>
        <h3 style="margin-left:10px">Betaflight Rates Tuner</h3>
        <hr>
        
        <div style="max-width:900px; display:inline-block; vertical-align: top">
            <div id="curve_chart" style="width: 900px; height: 600px; margin-top:-50px"></div>
            <div style="text-align:center; padding-top:50px">
                <span title="Zoom to first 50% of rate curve"><input id="zoom50" type="checkbox">Zoom 0%-50%</span>
                <span title="Plot relative change in rate (AKA: slope, sensitivity, commanded acceleration, feed-forward) vs. stick position"><input id="deriv" type="checkbox">Derivative</span>
                <span title="Plot relative change in slope vs. stick position"><input id="deriv2" type="checkbox">2nd Derivative</span>
            </div>
        </div>
        <div style="max-width:900px; display:inline-block; margin-left: auto; margin-right: auto; vertical-align: top; padding-top: 20px; padding-left:20px">
            <div>Lock Roll/Pitch Slope: <input id="lock" type="checkbox"></div>
            <h3>ALT TUNING PARAMS</h3>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title" title="Center-stick sensitivity">Slope:</span>
                        <span class="input-title">Max deg/s:</span>
                        <span class="input-title" title="Interpolant between Super Rate and Expo">Shape:</span>
                    </div>
                    <div>
                        <span class="input-title">ROLL</span>
                        <input title="Center-stick sensitivity" type="number" id="Slope1"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg1" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <input title="Interpolant between Super Rate and Expo" type="number" id="Shape1"  step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00' class="input-field-tuning"/>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <input title="Center-stick sensitivity" type="range" id="SlopeSlider1"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider1" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <input title="Interpolant between Super Rate and Expo" type="range" id="ShapeSlider1"  class="slider" step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00'/>
                    </div>
                </div>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title" title="Center-stick sensitivity">Slope:</span>
                        <span class="input-title">Max deg/s:</span>
                    </div>
                    <div>
                        <span class="input-title">PITCH</span>
                        <span class="input-title" id="pitchValue"></span>
                        <input title="Center-stick sensitivity" type="number" id="Slope2"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg2" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <span class="input-title"></span>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title" id="pitchValueSlider"></span>
                        <input title="Center-stick sensitivity" type="range" id="SlopeSlider2"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider2" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <span class="input-title"></span>
                    </div>
                </div>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title" title="Center-stick sensitivity">Slope:</span>
                        <span class="input-title">Max deg/s:</span>
                        <span class="input-title" title="Interpolant between Super Rate and Expo">Shape:</span>
                    </div>
                    <div>
                        <span class="input-title">YAW</span>
                        <input title="Center-stick sensitivity" type="number" id="Slope3"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg3" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <input title="Interpolant between Super Rate and Expo" type="number" id="Shape3"  step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00' class="input-field-tuning"/>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <input title="Center-stick sensitivity" type="range" id="SlopeSlider3"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider3" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <input title="Interpolant between Super Rate and Expo" type="range" id="ShapeSlider3"  class="slider" step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00'/>
                    </div>
                </div>
            <h3>BETAFLIGHT PARAMS</h3>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title">RC Rate:</span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title">RC Expo:</span>
                    <span class="input-title"></span>
                    <span class="input-title">OpenTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">ROLL</span>
                    <input type="number" id="bfRate1"  step="0.01" min="0.00" max="2.40" value="2.04" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfSuper1" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfExpo1"  step="0.01" min="0.00" max="1.00" value="0.45" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo1"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                </div>
                <div>
                    <span class="input-title"></span>
                    <input type="range" id="bfRateSlider1"  class="slider" step="0.01" min="0.00" max="2.40" value="2.04" placeholder='0.00'/>
                    <input type="range" id="bfSuperSlider1" class="slider" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00'/>
                    <input type="range" id="bfExpoSlider1"  class="slider" step="0.01" min="0.00" max="1.00" value="0.45" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider1"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <span class="input-title">OpenTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">PITCH</span>
                    <span class="input-title"></span>
                    <input type="number" id="bfSuper2" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo2"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <span class="input-title" id="otxValue"></span>
                </div>
                <div>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="range" id="bfSuperSlider2" class="slider" step="0.01" min="0.00" max="0.99" value="0.70" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider2"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title">RC Rate:</span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title">RC Expo:</span>
                    <span class="input-title"></span>
                    <span class="input-title">OpenTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">YAW</span>
                    <input type="number" id="bfRate3"  step="0.01" min="0.00" max="2.40" value="2.04" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfSuper3" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfExpo3"  step="0.01" min="0.00" max="1.00" value="0.61" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo3"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                </div>
                <div>
                    <span class="input-title"></span>
                    <input type="range" id="bfRateSlider3"  class="slider" step="0.01" min="0.00" max="2.40" value="2.04" placeholder='0.00'/>
                    <input type="range" id="bfSuperSlider3" class="slider" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00'/>
                    <input type="range" id="bfExpoSlider3"  class="slider" step="0.01" min="0.00" max="1.00" value="0.61" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider3"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div id="rate_choices" style="text-align: center; padding-top:40px">
                <h3 style="">Load Pilot Rates</h3>
                <select id="pilots">
                    <option value="0">--Select a pilot--</option>
                    <option value="1">(Default) Betaflight</option>
                    <option value="2">(Racing) Holdox</option>
                    <option value="30">(Racing) SFPV [old]</option>
                    <option value="3">(Racing) SFPV [new]</option>
                    <option value="4">(Racing) HOOPES</option>
                    <option value="5">(Racing) Minchan [F1]</option>
                    <option value="6">(Racing) Vanover [F1]</option>
                    <option value="7">(Racing) Headsup FPV</option>
                    <option value="8">(Racing) Nytfury [F1]</option>
                    <option value="100">(Racing) My rates</option>
                </select> 
                <div style="text-align: center; width:500px; padding-top:20px; margin-left:auto; margin-right:auto">
                    <span id="value0" style="display:none"></span>
                    <span id="value1" style="display:none">Default freestyle races</span>
                    <span id="value2" style="display:none">Stick-cam youtube link: <a target="_blank" href="https://youtu.be/5Q05eznuBHE">Holdox Goes CRAZY after drinking water!</a></span>
                    <span id="value30" style="display:none">Stick-cam youtube link: <a target="_blank" href="https://youtu.be/Iq9eghjXTfk">Velocidrone 1.12 Preview with Stick Cam!</a></span>
                    <span id="value3" style="display:none">Discussion: <a target="_blank" href="https://www.youtube.com/watch?v=BQasETrUF8Y&t=0s">Youtube</a></span>
                    <span id="value4" style="display:none"></span>
                    <span id="value5" style="display:none">FlightOne: 315-41-75, 256-33-49</span>
                    <span id="value6" style="display:none">FlightOne: 350-40-75</span>
                    <span id="value7" style="display:none">(<a target="_blank" href="https://www.youtube.com/watch?v=jUpAjoKQOXU">Youtube</a>)</span>
                    <span id="value8" style="display:none">FlightOne: 258-50-58, 147-20-40</span>
                    <span id="value100" style="display:none"></span>
                </div>
            </div>
        </div>
        <hr>
        <div style="vertical-align: top; padding: 30px 10px 60px 10px">

            <div>
                <a id="showRfRates" href="#" onclick="showRfRates(); return false;">Show Raceflight Rates </a>
                <a id="hideRfRates" style="display:none" href="#" onclick="hideRfRates(); return false;">Hide Raceflight Rates</a>
            </div>
            
            <div id="rfRates" style="display:none; margin:auto; max-width:900px">
                <h3> Add RaceFlight reference rates (Rate,Expo,Acro+)</h3>
                <div>
                    <span>On/off</span><input id="rf" type="checkbox">
                    <input type="number" id="rfRate"  step="1" min="0.00" max="5000" value="315" placeholder='0.00' class="input-field"/>
                    <input type="number" id="rfExpo"  step="1" min="0.00" max="1000" value="41" placeholder='0.00' class="input-field"/>
                    <input type="number" id="rfSuper" step="1" min="0.00" max="1000" value="75" placeholder='0.00' class="input-field"/>
                </div>
        
                <div style="padding:2em 0 0 0;">
                    <b>Raceflight > Betaflight</b>, Method 
                    <select id="r2b">
                        <option value="4" title="Initial slope within +/-50%, searches for best fit (minimum avg. error).">1-Wide search</option>
                        <option value="3" title="Initial slope within +/-10%, searches for best fit (minimum avg. error).">2-Narrow search</option>
                        <option value="5" title="(MAY BE SLOW) Searches for minimum fit error, initial slope within +/- 50%">3-Lowest Error</option>
                        <option value="2" title="Constrained to match initial slope, searches for best fit (minimum avg. error).">4-Center-match /A</option>
                        <option value="0" title="Uses closed-form equation to convert rates: exactly matches 1/center-stick slope, 2/slope derivative, and 3/ Max deg/s.">5-Center-match /B</option>
                    </select> 
                    <span style="padding:0 1.5em 0 1.5em"><a href="#" title="Using these Raceflight rates, converts and copies to Betaflight/Roll rates above." onclick="convertRoll(); return false;">&#10532; Roll</a></span><span style="padding:0 0 1.5em 0"><a href="#" title="Using these Raceflight rates, converts and copies to Betaflight/Yaw rates above." onclick="convertYaw(); return false;">&#10532; Yaw</a></span>
                </div>
                <div style="padding:2em 0 0 0;">
                    <b>Betaflight > Raceflight</b>, Method 
                    <select id="b2r">
                        <option value="4" title="Initial slope within +/-50%, searches for best fit (minimum avg. error).">1-Wide search</option>
                        <option value="3" title="Initial slope within +/-10%, searches for best fit (minimum avg. error).">2-Narrow search</option>
                        <option value="5" title="(MAY BE SLOW) Searches for minimum fit error, initial slope within +/- 50%">3-Lowest Error</option>
                        <option value="2" title="Constrained to match initial slope, searches for best fit (minimum avg. error).">4-Center-match /A</option>
                        <option value="0" title="Uses closed-form equation to convert rates: exactly matches 1/center-stick slope, 2/slope derivative, and 3/ Max deg/s.">5-Center-match /B</option>
                    </select> 
                    <span style="padding:0 1.5em 0 1.5em"><a href="#" title="Using Betaflight/Roll rates above, converts and copies to the Raceflight rates listed here" onclick="convertRoll2RF(); return false;">&#10534; Roll</a></span><span style="padding:0 0 1em 0"><a href="#" title="Using Betaflight/Yaw rates above, converts and copies to the Raceflight rates listed here" onclick="convertYaw2RF(); return false;">&#10534; Yaw</a></span>
                </div>
                
            </div>

            <div>
                <a id="showHelp" href="#" onclick="showHelp(); return false;">Show help </a>
                <a id="hideHelp" style="display:none" href="#" onclick="hideHelp(); return false;">Hide help</a>
            </div>
            
            
            <div id="help" style="display:none; margin:auto; max-width:900px">
                <h3>Help</h3>
                <ul>
                    <li><b>Slope</b> represents center-stick sensitivity.  The value is scaled such that it's equivalent to RC Rate when no Expo is present.</li>
                    <li><b>Shape</b> interpolates between a curve based on Super Rate, and a curve based on Expo.  While adjusting, Slope and Max deg/s are unaffected.</li>
                    <li><b>OpenTX Expo</b> refers to the expo curve on an Open TX-based tranmitter--<u><i>typically zero.</i></u>.  <i>Negative</i> <b>OpenTX Expo</b> adds a few interesting possibilities for adjusting curve shape.</li>
                    <li>If <b>Super Rate</b> value is red in color, a negative <b>OpenTX Expo</b> is causing a non-increasing slope.  To resolve, <b>Super Rate</b> should be increased.</li>
                    <li>Checking the <b>Derivative</b>-box plots the change in <b>Slope</b> versus stick position.</li>
                    <li><b>FlightOne/Raceflight conversion</b> offers fits based on minimizing average error (Methods 1,2,4) or minimizing the single largest error across stick travel (Methd 3).  Methods 1 & 3 are constrained to fits within +/-50% of the source initial slope, whereas Method 2 constrains initial slope to within +/-10%.  Method 5 is based on closed-form equations which exactly match center-stick shape and Max deg/s.</li>
                    <li><b>Method 2</b> (Narrow search) is the recommended method for FlightOne/Raceflight to Betaflight conversion.  Each approach has merits and drawbacks, this approach being a good compromise between maintaining center-stick "feel", while not grossly misrepresenting latter portions of the curve.</li>
                </ul>
                <hr>
                <h3>Links</h3>
                <ul>
                    <li><a target="_blank" href="https://flightone.com/rates">FlightOne Converter</a></li>
                    <li><a target="_blank" href="https://github.com/apocolipse/RotorPirates">Github Rates Converter</a></li>
                </ul>
                
            </div>
        </div>
    </body>
    </body>
</html>
