<html>
    <head>
        <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> -->
        <link rel="stylesheet" href="betaflight_rates.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <script type="text/javascript">

            var doDraw=true;
            var checkBox = null;
            var checkOptions = [];

            var clamp = function(n, minn, maxn) {
                if(isNaN(n))
                    n=0.5;
                return Math.max(Math.min(maxn, n), minn)
            }

            // BF rate calculation function
            var bfcalc = function(rcCommand, rcRate, expo, superRate) {

                var absRcCommand = Math.abs(rcCommand);

                if(rcRate > 2.0)
                    rcRate = rcRate + (14.54 * (rcRate - 2.0))

                if(expo != 0)
                    rcCommand = rcCommand * Math.abs(rcCommand)**3 * expo + rcCommand * (1.0 - expo)

                angleRate = 200.0 * rcRate * rcCommand;
                if(superRate != 0){
                    rcSuperFactor = 1.0 / (clamp(1.0 - absRcCommand * (superRate), 0.01, 1.00))
                    angleRate *= rcSuperFactor
                }

                return angleRate
            }

            //Open TX expo function
            var expo_otx_calc = function(rcCommand, expo_otx){
                if(expo_otx < 0){
                    rcCommand = 1+expo_otx*(1-rcCommand)**3-(1-rcCommand)*(1+expo_otx)
                } else if(expo_otx > 0){
                    rcCommand = expo_otx*rcCommand**3+rcCommand*(1-expo_otx)
                }
                return rcCommand
            }

            var updateRcRateUnadjusted = function(expo_otx, Slope, Maxdeg, Shape){
                if (Maxdeg==0)
                    return 0
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                minRcRate=Slope/kotx;
                maxRcRate=Maxdeg/200;
                rcRate = minRcRate*Shape+(1-Shape)*maxRcRate;
                return rcRate
            }

            var adjustRcRate = function(rcRate){
                rcRate = Math.min(rcRate,2+(rcRate-2)/14.54);
                return Math.round(100*rcRate)/100
            }

            var unadjustedRcRate = function(rcRate){
                rcRate = rcRate+Math.max(0,(rcRate-2)*14.54);
                return rcRate
            }

            var updateSuperRate = function(rcRate,Maxdeg){
                //must be real rcRate
                superRate = Math.max(0,1-200*rcRate/Maxdeg);
                return Math.round(100*superRate)/100
            }

            var updateExpo = function(rcRate,expo_otx,Slope){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                expo = 1-Slope/(rcRate*kotx);
                return Math.round(100*expo)/100
            }

            var updateExpo_otx = function(rcRate,expo,Slope){
                //must be real rcRate
                expo_otx = 1-Slope/(rcRate*(1-expo));
                expo_otx = (expo_otx>0)?(expo_otx):(0.5*expo_otx);
                return Math.round(100*expo_otx)/100
            }

            var updateSlope = function(rcRate,expo,expo_otx){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                Slope = rcRate*(1-expo)*kotx;
                return Slope
            }

            var updateMaxdeg = function(rcRate,superRate){
                //must be real rcRate
                Maxdeg = rcRate*200/(1-superRate);
                return Maxdeg
            }

            var updateShape = function(rcRate,expo_otx,Slope,Maxdeg){
                //must be real rcRate
                kotx=(expo_otx<=0)?(1-2*expo_otx):(1-expo_otx);
                minRcRate=Slope/kotx;
                maxRcRate=Maxdeg/200;
                Shape =(rcRate-maxRcRate)/(minRcRate-maxRcRate);
                return Shape
            }

            var checkboxCallback = function(){
                if(checkBox.checked){
                    $('#Slope2').hide();
                    $('#SlopeSlider2').hide();
                    $('#pitchValue').show().text($('#Slope1').val().toString());
                    $('#pitchValueSlider').show();
                    $('#otxNegExpo2').hide();
                    $('#otxNegExpoSlider2').hide();
                    $('#otxValue').show().text($('#otxNegExpo1').val().toString());
                } else {
                    $('#Slope2').show().val($('#Slope2').val()).change();
                    $('#SlopeSlider2').show().val($('#Slope2').val()).change();
                    $('#pitchValue').hide();
                    $('#pitchValueSlider').hide();
                    $('#otxNegExpo2').show().val($('#otxNegExpo1').val()).change();;
                    $('#otxNegExpoSlider2').show().val($('#otxNegExpo1').val()).change();
                    $('#otxValue').hide();
                }
                return null
            }

            var setRates = function(a){
                if(a[0]==0){
                    checkBox.checked=false;
                } else {
                    checkBox.checked=true;
                }
                checkboxCallback();
                $('#bfRate1').val(a[1]).change();
                $('#bfSuper1').val(a[2]).change();
                $('#bfExpo1').val(a[3]).change();
                $('#otxNegExpo1').val(a[4]).change();
                $('#bfSuper2').val(a[5]).change();
                $('#otxNegExpo2').val(a[6]).change();
                $('#bfRate3').val(a[7]).change();
                $('#bfSuper3').val(a[8]).change();
                $('#bfExpo3').val(a[9]).change();
                $('#otxNegExpo3').val(a[10]).change();
                return null
            }

            function drawChart(update) {

                doDraw=false;

                if (update==1){
                    //update tuning inputs/sliders
                    //(1 get input value, 2 update local sliders, 3 calc, 4 update calc'd inputs&sliders)

                    //Roll.1
                    Slope1 = clamp(parseFloat($('#Slope1').val(), 10),0,3.16);
                    Maxdeg1 = clamp(parseFloat($('#Maxdeg1').val(), 10),0,3001);
                    Shape1 = clamp(parseFloat($('#Shape1').val(), 10),0,1);
                    otxNegExpo1 = clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999);
                    //Roll.2
                    $('#SlopeSlider1').val(Slope1).change();
                    $('#MaxdegSlider1').val(Maxdeg1).change();
                    $('#ShapeSlider1').val(Shape1).change();
                    $('#otxNegExpoSlider1').val(otxNegExpo1).change();
                    //Roll.3,4
                    rc = updateRcRateUnadjusted(otxNegExpo1, Slope1, Maxdeg1, Shape1);
                     $('#bfRate1').val(clamp(adjustRcRate(rc),0,2.18)).change();
                     $('#bfExpo1').val(clamp(updateExpo(rc,otxNegExpo1,Slope1),-0.01,1)).change();
                     $('#bfSuper1').val(clamp(updateSuperRate(rc,Maxdeg1),0,1)).change();
                     $('#bfRateSlider1').val(clamp(adjustRcRate(rc),0,2.18)).change();
                     $('#bfExpoSlider1').val(clamp(updateExpo(rc,otxNegExpo1,Slope1),-0.01,1)).change();
                     $('#bfSuperSlider1').val(clamp(updateSuperRate(rc,Maxdeg1),0,1)).change();

                    //Pitch.1
                    if(checkBox.checked){
                        Slope2 = Slope1;
                        $('#pitchValue').text($('#Slope1').val().toString());
                        otxNegExpo2 = otxNegExpo1;
                        $('#otxValue').text($('#otxNegExpo1').val().toString());
                    } else {
                        Slope2 = clamp(parseFloat($('#Slope2').val(), 10),0,3.16);
                        otxNegExpo2 = clamp(-Slope2/(rc*(1-parseFloat($('#bfExpo1').val(), 10)))/2+0.5,-1,0.999);
                        if(otxNegExpo2>0)
                            otxNegExpo2=2*otxNegExpo2;
                    }
                    
                    Maxdeg2 = clamp(parseFloat($('#Maxdeg2').val(), 10),0,3001);
                    //Shape2 = clamp((rc-Maxdeg2/200)/(Slope2-Maxdeg2/200),0,1);
                    
                    //Pitch.2
                    $('#SlopeSlider2').val(Slope2).change();
                    $('#MaxdegSlider2').val(Maxdeg2).change();
                    $('#otxNegExpoSlider2').val(otxNegExpo2).change();
                    //Pitch.3,4
                    $('#bfSuper2').val(clamp(updateSuperRate(rc,Maxdeg2),0,1)).change();
                    $('#bfSuperSlider2').val(clamp(updateSuperRate(rc,Maxdeg2),0,1)).change();
                    $('#otxNegExpo2').val(Math.round(100*otxNegExpo2)/100).change();

                    //Yaw.1
                    Slope3 = clamp(parseFloat($('#Slope3').val(), 10),0,3.16);
                    Maxdeg3 = clamp(parseFloat($('#Maxdeg3').val(), 10),0,3001);
                    Shape3 = clamp(parseFloat($('#Shape3').val(), 10),0,1);
                    otxNegExpo3 = clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999);
                    //Yaw.2
                    $('#SlopeSlider3').val(Slope3).change();
                    $('#MaxdegSlider3').val(Maxdeg3).change();
                    $('#ShapeSlider3').val(Shape3).change();
                    $('#otxNegExpoSlider3').val(otxNegExpo3).change();
                    //Yaw.3,4
                    rc = updateRcRateUnadjusted(otxNegExpo3, Slope3, Maxdeg3, Shape3);
                     $('#bfRate3').val(clamp(adjustRcRate(rc),0,2.18)).change();
                     $('#bfExpo3').val(clamp(updateExpo(rc,otxNegExpo3,Slope3),-0.01,1)).change();
                     $('#bfSuper3').val(clamp(updateSuperRate(rc,Maxdeg3),0,1)).change();
                     $('#bfRateSlider3').val(clamp(adjustRcRate(rc),0,2.18)).change();
                     $('#bfExpoSlider3').val(clamp(updateExpo(rc,otxNegExpo3,Slope3),-0.01,1)).change();
                     $('#bfSuperSlider3').val(clamp(updateSuperRate(rc,Maxdeg3),0,1)).change();

                }

                bfRate1 = clamp(parseFloat($('#bfRate1').val(), 10),0,2.18);
                bfExpo1 = clamp(parseFloat($('#bfExpo1').val(), 10),-0.01,1);
                bfSuper1 = clamp(parseFloat($('#bfSuper1').val(), 10),0,1);
                otxNegExpo1 = clamp(parseFloat($('#otxNegExpo1').val(), 10),-1,0.999);

                bfSuper2 = clamp(parseFloat($('#bfSuper2').val(), 10),0,1);
                if(checkBox.checked){
                    otxNegExpo2 = otxNegExpo1;
                    $('#otxValue').text($('#otxNegExpo1').val().toString());
                } else {
                    otxNegExpo2 = clamp(parseFloat($('#otxNegExpo2').val(), 10),-1,0.999);
                }

                bfRate3 = clamp(parseFloat($('#bfRate3').val(), 10),0,2.18);
                bfExpo3 = clamp(parseFloat($('#bfExpo3').val(), 10),-0.01,1);
                bfSuper3 = clamp(parseFloat($('#bfSuper3').val(), 10),0,1);
                otxNegExpo3 = clamp(parseFloat($('#otxNegExpo3').val(), 10),-1,0.999);

                if (update==0 || update==undefined){
                    //update configurator inputs/sliders
                    //(1 get input value, 2 update local sliders, 3 calc, 4 update calc'd inputs&sliders)

                    //Roll.1 (above)
                    //Roll.2
                    $('#bfRateSlider1').val(bfRate1).change();
                    $('#bfExpoSlider1').val(bfExpo1).change();
                    $('#bfSuperSlider1').val(bfSuper1).change();
                    $('#otxNegExpoSlider1').val(otxNegExpo1).change();
                    //Roll.3
                    rc = clamp(unadjustedRcRate(bfRate1),0,4);
                    slp=clamp(updateSlope(rc,bfExpo1,otxNegExpo1),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper1),0,3001);
                    shp=clamp(updateShape(rc,otxNegExpo1,slp,mxdeg),0,1);
                    //Roll.4
                    $('#Slope1').val(Math.round(200*slp)/200).change();
                    $('#Maxdeg1').val(Math.round(mxdeg)).change();
                    $('#Shape1').val(Math.round(1000*shp)/1000).change();
                    $('#SlopeSlider1').val(slp).change();
                    $('#MaxdegSlider1').val(mxdeg).change();
                    $('#ShapeSlider1').val(shp).change();
                   
                    //Pitch.1 (above)
                    //Pitch.2
                    $('#bfSuperSlider2').val(bfSuper2).change();
                    $('#otxNegExpoSlider2').val(otxNegExpo2).change();
                    if(checkBox.checked){
                        $('#otxValue').show().text($('#otxNegExpo1').val().toString());
                    }
                    //Pitch.3
                    slp=clamp(updateSlope(rc,bfExpo1,otxNegExpo2),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper2),0,3001);
                    //shp=updateShape(rc,otxNegExpo2,slp,mxdeg);
                    //Pitch.4
                    $('#Slope2').val(Math.round(200*slp)/200).change();
                    if(checkBox.checked){
                        $('#pitchValue').show().text($('#Slope2').val().toString());
                    }
                    $('#Maxdeg2').val(Math.round(mxdeg)).change();
                    $('#SlopeSlider2').val(slp).change();
                    $('#MaxdegSlider2').val(mxdeg).change();

                    //Yaw.1 (above)
                    //Yaw.2
                    $('#bfRateSlider3').val(bfRate3).change();
                    $('#bfExpoSlider3').val(bfExpo3).change();
                    $('#bfSuperSlider3').val(bfSuper3).change();
                    $('#otxNegExpoSlider3').val(otxNegExpo3).change();
                    //Yaw.3
                    rc = clamp(unadjustedRcRate(bfRate3),0,3.16);
                    slp=clamp(updateSlope(rc,bfExpo3,otxNegExpo3),0,3.16);
                    mxdeg=clamp(updateMaxdeg(rc,bfSuper3),0,3001);
                    shp=clamp(updateShape(rc,otxNegExpo3,slp,mxdeg),0,1);
                    //Yaw.4
                    $('#Slope3').val(Math.round(200*slp)/200).change();
                    $('#Maxdeg3').val(Math.round(mxdeg)).change();
                    $('#Shape3').val(Math.round(1000*shp)/1000).change();
                    $('#SlopeSlider3').val(slp).change();
                    $('#MaxdegSlider3').val(mxdeg).change();
                    $('#ShapeSlider3').val(shp).change();


                }


                var ratesData = [];

                var data = new google.visualization.DataTable();
				data.addColumn('number', 'Stick Input');
                data.addColumn('number', 'ROLL');
                data.addColumn('number', 'PITCH');
                data.addColumn('number', 'YAW');

                var stickEnd=1.0;
                var stickIter=0.01;
                if (checkOptions[0].checked){
                    var stickEnd=0.25;
                    var stickIter=0.0025;
                } else if (checkOptions[1].checked) {
                    var stickEnd=0.5;
                    var stickIter=0.005;
                }
                    
                if (checkOptions[2].checked){
                    //derivative
                    for (var i = 0; i <= stickEnd; i+=stickIter) {
                        data.addRow([
                            i,
                            (bfcalc(expo_otx_calc(i+stickIter,otxNegExpo1), bfRate1, bfExpo1, bfSuper1)-
                             bfcalc(expo_otx_calc(i,otxNegExpo1), bfRate1, bfExpo1, bfSuper1))/stickIter/200,
                            (bfcalc(expo_otx_calc(i+stickIter,otxNegExpo2), bfRate1, bfExpo1, bfSuper2)-
                            bfcalc(expo_otx_calc(i,otxNegExpo2), bfRate1, bfExpo1, bfSuper2))/stickIter/200,
                            (bfcalc(expo_otx_calc(i+stickIter,otxNegExpo3), bfRate3, bfExpo3, bfSuper3)-
                            bfcalc(expo_otx_calc(i,otxNegExpo3), bfRate3, bfExpo3, bfSuper3))/stickIter/200
                        ]);
                    }
                } else if (checkOptions[3].checked) {
                    //avg slope
                    var avg_sum=[0, 0, 0];
                    for (var i = 0; i <= stickEnd/2; i+=stickIter) {
                        avg_sum[0]=avg_sum[0]
                            +(bfcalc(expo_otx_calc(i,otxNegExpo1), bfRate1, bfExpo1, bfSuper1))*stickIter;
                        avg_sum[1]=avg_sum[1]
                            +(bfcalc(expo_otx_calc(i,otxNegExpo2), bfRate1, bfExpo1, bfSuper2))*stickIter;
                        avg_sum[2]=avg_sum[2]
                            +(bfcalc(expo_otx_calc(i,otxNegExpo3), bfRate3, bfExpo3, bfSuper3))*stickIter;
                        data.addRow([
                            i,
                            (avg_sum[0]/(i+1)**2),
                            (avg_sum[1]/(i+1)**2),
                            (avg_sum[2]/(i+1)**2)
                        ]);
                    }
                } else {
                    for (var i = 0; i <= stickEnd; i+=stickIter) {
                        data.addRow([
                            i,
                            bfcalc(expo_otx_calc(i,otxNegExpo1), bfRate1, bfExpo1, bfSuper1),
                            bfcalc(expo_otx_calc(i,otxNegExpo2), bfRate1, bfExpo1, bfSuper2),
                            bfcalc(expo_otx_calc(i,otxNegExpo3), bfRate3, bfExpo3, bfSuper3)
                        ]);
                    }
                }

                var options = {
                    width: 900,
                    height: 600,
                    titlePosition: 'none',
                    curveType: 'function',
                    legend: {
                        position: 'bottom',
                        textStyle: {color: "#888"}
                    },
                    backgroundColor: { fill:'transparent' },
                    hAxis: {
                        baselineColor: "#888",
                        gridlines: {color: "#888"},
                        textStyle: {color: "#888"}
                    },
                    vAxis: {
                        baselineColor: "#888",
                        gridlines: {color: "#888"},
                        textStyle: {color: "#888"}
                    }
                };

                var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

                chart.draw(data, options);

                doDraw = true;
            }

            var showHelp = function(){
                $('#help').show();
                $('#showHelp').hide();
                $('#hideHelp').show();
            }

            var hideHelp = function(){
                $('#help').hide();
                $('#showHelp').show();
                $('#hideHelp').hide();
            }

            $( document ).ready(function() {
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawChart);
                //callbacks

                //sliders, configurator
                $('#bfRateSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfRate1').val(this.value).change();
                });
                $('#bfExpoSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfExpo1').val(this.value).change();
                });
                $('#bfSuperSlider1').on('input', function() {
                    if (doDraw)
                        $('#bfSuper1').val(this.value).change();
                });
                $('#otxNegExpoSlider1').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo1').val(this.value).change();
                });

                $('#bfSuperSlider2').on('input', function() {
                    if (doDraw)
                        $('#bfSuper2').val(this.value).change();
                });
                $('#otxNegExpoSlider2').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo2').val(this.value).change();
                });

                $('#bfRateSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfRate3').val(this.value).change();
                });
                $('#bfExpoSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfExpo3').val(this.value).change();
                });
                $('#bfSuperSlider3').on('input', function() {
                    if (doDraw)
                        $('#bfSuper3').val(this.value).change();
                });
                $('#otxNegExpoSlider3').on('input', function() {
                    if (doDraw)
                        $('#otxNegExpo3').val(this.value).change();
                });

                //sliders, tuning
                $('#SlopeSlider1').on('input', function() {
                    if (doDraw)
                        $('#Slope1').val(this.value).change();
                });
                $('#MaxdegSlider1').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg1').val(this.value).change();
                });
                $('#ShapeSlider1').on('input', function() {
                    if (doDraw)
                        $('#Shape1').val(this.value).change();
                });

                $('#SlopeSlider2').on('input', function() {
                    if (doDraw)
                        $('#Slope2').val(this.value).change();
                });
                $('#MaxdegSlider2').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg2').val(this.value).change();
                });

                $('#SlopeSlider3').on('input', function() {
                    if (doDraw)
                        $('#Slope3').val(this.value).change();
                });
                $('#MaxdegSlider3').on('input', function() {
                    if (doDraw)
                        $('#Maxdeg3').val(this.value).change();
                });
                $('#ShapeSlider3').on('input', function() {
                    if (doDraw)
                        $('#Shape3').val(this.value).change();
                });

                //lock checkbox
                checkBox = document.getElementById("lock");

                $(checkBox).on('change',function(){
                    checkboxCallback();
                    drawChart(0);
                });

                checkBox.checked=true;
                checkboxCallback();

                //options checkbox
                checkOptions[0] = document.getElementById("zoom25");
                checkOptions[1] = document.getElementById("zoom50");
                checkOptions[2] = document.getElementById("deriv");
                checkOptions[3] = document.getElementById("avg");

                $(checkOptions).on('change',function(evt){
                    $(checkOptions).not(evt.target).prop('checked',false);
                    $(checkOptions).parent().removeAttr('style');
                    if(evt.target.checked){
                        $(evt.target).parent().css('color','blue');
                    }
                        
                    drawChart(0);
                });
                $(checkOptions).prop('checked',false);

                //draw
                $(".input-field").on("change paste enter keyup", function() {
                    if (doDraw)
                        drawChart(0);
                });
                $(".input-field-tuning").on("change paste enter keyup", function() {
                    if (doDraw)
                        drawChart(1);
                });

                $('select').on('change', function() {
                    doDraw=false;
                    $('#rate_choices').find('span').hide();
                    switch (this.value){
                        case '1': //default
                        $('#value1').show();
                        setRates( 
                            [1,
                            1.0,0.7,0,0,
                            0.7,0,
                            1.0,0.7,0,0]);
                        break
                        case '2': //holdox
                        $('#value2').show();
                        setRates( 
                            [1,
                            2.04,0,0.45,0,
                            0,0,
                            2.04,0,0.61,0]);
                        break
                        case '3': //sfpv
                        $('#value3').show();
                        setRates( 
                            [1,
                            0.8,0.63,0,0,
                            0.63,0,
                            0.6,0.5,0,0]);
                        break
                        case '4': //beginner
                        $('#value4').show();
                        setRates( 
                            [1,
                            1.33,0.38,0,0,
                            0.38,0,
                            1.1,0.49,0,0]);
                        break
                        case '5': //intermediate
                        $('#value5').show();
                        setRates( 
                            [1,
                            1,0.61,0,0,
                            0.61,0,
                            1,0.61,0,0]);
                        break
                       /* case '100': //my rates 1
                        $('#value100').show();
                        setRates( 
                            [0,
                            2.00,0.05,0.47,-0.1,
                            0.0,0,
                            0.46,0.77,0,-0.5]);
                        break
                        case '101': //my rates 2
                        $('#value101').show();
                        setRates( 
                            [0,
                            1.75,0.17,0.40,-0.1,
                            0.13,0.0,
                            0.43,0.77,0,-0.5]);
                        break
                        case '102': //my rates 3
                        $('#value102').show();
                        setRates( 
                            [0,
                            1.75,0.20,0.42,-0.1,
                            0.17,0.0,
                            0.36,0.82,0,-0.5]);
                        break
                        case '103': //my rates 4
                        $('#value103').show();
                        setRates( 
                            [0,
                            2,0.08,0.45,-0.05,
                            0.08,0.0,
                            0.32,0.84,0,-0.55]);
                        break
                        
                        case '104': //my rates 5
                        $('#value104').show();
                        setRates( 
                            [0,
                            2,0.09,0.45,-0.05, //using as high as 0.48
                            0.09,0.0,
                            0.29,0.86,0,-0.55]); //using as low as 0.27
                            
                        break*/
                        case '104': //my rates 5
                        $('#value104').show();
                        setRates( 
                            [0,
                            2,0.09,0.45,-0.05, //using as high as 0.48
                            0.09,0.0,
                            0.25,0.88,0,-0.7]); //using as low as 0.27
                            
                        break
                    }
                    doDraw=true;
                    drawChart();
                });
            });

            </script>
    </head>
    <body>
        <h3 style="margin-left:10px">Betaflight Rates Tuner</h3>
        <div style="padding-left:10px">An alternative approach for setting rates in Betaflight.</div>
        <hr>
        
        <div style="max-width:900px; display:inline-block; vertical-align: top">
            <div id="curve_chart" style="width: 900px; height: 600px; margin-top:-50px"></div>
            <div style="text-align:center; padding-top:50px">
                <span>Zoom 0%-25%<input id="zoom25" type="checkbox"></span>
                <span>Zoom 0%-50%<input id="zoom50" type="checkbox"></span>
                <span>Derivative<input id="deriv" type="checkbox"></span>
                <span>Integral<input id="avg" type="checkbox"></span>
            </div>
        </div>
        <div style="max-width:900px; display:inline-block; margin-left: auto; margin-right: auto; vertical-align: top; padding-top: 20px; padding-left:20px">
            <div>Lock Roll/Pitch Slope: <input id="lock" type="checkbox"></div>
            <h3>ALT TUNING PARAMS</h3>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title">Slope:</span>
                        <span class="input-title">Max deg/s:</span>
                        <span class="input-title">Shape:</span>
                    </div>
                    <div>
                        <span class="input-title">ROLL</span>
                        <input type="number" id="Slope1"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg1" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Shape1"  step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00' class="input-field-tuning"/>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <input type="range" id="SlopeSlider1"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider1" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <input type="range" id="ShapeSlider1"  class="slider" step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00'/>
                    </div>
                </div>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title">Slope*:</span>
                        <span class="input-title">Max deg/s:</span>
                    </div>
                    <div>
                        <span class="input-title">PITCH</span>
                        <span class="input-title" id="pitchValue"></span>
                        <input type="number" id="Slope2"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg2" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <span class="input-title"></span>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title" id="pitchValueSlider"></span>
                        <input type="range" id="SlopeSlider2"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider2" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <span class="input-title"></span>
                    </div>
                </div>
                <div class="rateBox">
                    <div>
                        <span class="input-title"></span>
                        <span class="input-title">Slope:</span>
                        <span class="input-title">Max deg/s:</span>
                        <span class="input-title">Shape:</span>
                    </div>
                    <div>
                        <span class="input-title">YAW</span>
                        <input type="number" id="Slope3"  step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Maxdeg3" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00' class="input-field-tuning"/>
                        <input type="number" id="Shape3"  step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00' class="input-field-tuning"/>
                    </div>
                    <div>
                        <span class="input-title"></span>
                        <input type="range" id="SlopeSlider3"  class="slider" step="0.005" min="0.00" max="3.15" value="1.00" placeholder='0.00'/>
                        <input type="range" id="MaxdegSlider3" class="slider" step="1.00" min="0.00" max="3000.00" value="525.00" placeholder='0.00'/>
                        <input type="range" id="ShapeSlider3"  class="slider" step="0.001" min="0.00" max="1.00" value="0.00" placeholder='0.00'/>
                    </div>
                </div>
            <h3>CONFIGURATOR PARAMS</h3>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title">RC Rate:</span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title">RC Expo:</span>
                    <span class="input-title"></span>
                    <span class="input-title">OTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">ROLL</span>
                    <input type="number" id="bfRate1"  step="0.01" min="0.00" max="2.17" value="2.04" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfSuper1" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfExpo1"  step="0.01" min="0.00" max="1.00" value="0.45" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo1"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                </div>
                <div>
                    <span class="input-title"></span>
                    <input type="range" id="bfRateSlider1"  class="slider" step="0.01" min="0.00" max="2.17" value="2.04" placeholder='0.00'/>
                    <input type="range" id="bfSuperSlider1" class="slider" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00'/>
                    <input type="range" id="bfExpoSlider1"  class="slider" step="0.01" min="0.00" max="1.00" value="0.45" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider1"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <span class="input-title">OTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">PITCH</span>
                    <span class="input-title"></span>
                    <input type="number" id="bfSuper2" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo2"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <span class="input-title" id="otxValue"></span>
                </div>
                <div>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="range" id="bfSuperSlider2" class="slider" step="0.01" min="0.00" max="0.99" value="0.70" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider2"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div class="rateBox">
                <div>
                    <span class="input-title"></span>
                    <span class="input-title">RC Rate:</span>
                    <span class="input-title">Super Rate:</span>
                    <span class="input-title">RC Expo:</span>
                    <span class="input-title"></span>
                    <span class="input-title">OTX Expo:</span>
                </div>
                <div>
                    <span class="input-title">YAW</span>
                    <input type="number" id="bfRate3"  step="0.01" min="0.00" max="2.17" value="2.04" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfSuper3" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                    <input type="number" id="bfExpo3"  step="0.01" min="0.00" max="1.00" value="0.61" placeholder='0.00' class="input-field"/>
                    <span class="input-title"></span>
                    <input type="number" id="otxNegExpo3"  step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00' class="input-field"/>
                </div>
                <div>
                    <span class="input-title"></span>
                    <input type="range" id="bfRateSlider3"  class="slider" step="0.01" min="0.00" max="2.17" value="2.04" placeholder='0.00'/>
                    <input type="range" id="bfSuperSlider3" class="slider" step="0.01" min="0.00" max="0.99" value="0.00" placeholder='0.00'/>
                    <input type="range" id="bfExpoSlider3"  class="slider" step="0.01" min="0.00" max="1.00" value="0.61" placeholder='0.00'/>
                    <span class="input-title"></span>
                    <input type="range" id="otxNegExpoSlider3"  class="slider" step="0.01" min="-1.00" max="0.99" value="0.00" placeholder='0.00'/>
                </div>
            </div>
            <div id="rate_choices" style="text-align: center; padding-top:40px">
                <h3 style="">Load Pilot Rates</h3>
                <select style="">
                    <option value="0">--Select a pilot--</option>
                    <option value="1">(Default) Betaflight</option>
                    <option value="2">(Racing) Holdox</option>
                    <option value="3">(Racing) SFPV</option>
                    <option value="4">(Racing) Beginner</option>
                    <option value="5">(Racing) Intermediate</option>
                    <option value="104">(Racing) Crazy Yaw</option>
                </select> 
                <div style="text-align: center; width:500px; padding-top:20px; margin-left:auto; margin-right:auto">
                    <span id="value0" style="display:none"></span>
                    <span id="value1" style="display:none">Default freestyle races</span>
                    <span id="value2" style="display:none">Stick-cam youtube link: <a target="_blank" href="https://youtu.be/5Q05eznuBHE">Holdox Goes CRAZY after drinking water!</a></span>
                    <span id="value3" style="display:none">Stick-cam youtube link: <a target="_blank" href="https://youtu.be/Iq9eghjXTfk">Velocidrone 1.12 Preview with Stick Cam!</a></span>
                    <span id="value4" style="display:none">Beginner rates. Made to be responsive & lower top-end.</span>
                    <span id="value5" style="display:none">Intermediate rates. Gives improved precision & higher top-end.</span>
                   <span id="value104" style="display:none">Using Open-TX Expo to give a fast-growing yaw and using Open-TX expo to give Pitch a slightly lower sensitivity compared to Roll.</span>
                </div>
            </div>
        </div>
        <hr>
        <hr>
        <div style="vertical-align: top; padding: 30px 10px 60px 10px">
            <a id="showHelp" href="#" onclick="showHelp(); return false;">Show help</a>
            <a id="hideHelp" style="display:none" href="#" onclick="hideHelp(); return false;">Hide help</a>
            <div id="help" style="display:none; margin:auto; max-width:900px">
                <h3>Parameter definitions</h3>
                <ul>
                    <li><b>Slope</b> sets the rate-increase at mid-stick, affecting precision. Typically between 0.6 to 1.5.</li>
                    <li><b>Shape</b> determines how the rate curve grows versus stick command.  Set <b>Shape=1</b> for a curve based on Super Rate. Values less than <b>1</b> will add more and more <b>RC Expo</b>.</li>
                    <li><b>OTX Expo</b> refers to the expo curve on an Open TX-based tranmitter.  <u><i>Typically zero.</i></u>.  Included here as <i>negative</i> <b>OTX Expo</b> has potential of (1) increasing mid-stick resolution, (2) decoupling ROLL/PITCH mid-stick sensitivty, and (3) enabling faster growth from low initial <b>Slope</b> to a mid-tier <b>Max deg/s</b>.</li>
                </ul>
                <h3>Plot checkboxes</h3>
                <ul>
                    <li>Checking the <b>Derivative</b>-box plots the change in <b>Slope</b> versus stick position.  Obviously, higher values or funky looking curves imply less ability to dial in the precise, desired rate.</li>
                    <li>Checking the <b>Integral</b>-box plots for the integral of rates, a framework for comparing effective "feel" (resulting rotation) of small stick-throws.</li>
                </ul>
                <!--
                <h3>Beginner advice (racing rates)</h3>
                <ul>
                    <li>Setting your rates is a battle between precision, responsiveness, intuition, and handicaps.  Don't expect to find your "dream" rates overnight!</li>
                    <li>Common internet advice is to start with low rates, I disagree. A higher, ~linear <b>Slope</b> is usually the most intuitive as it provides immediate feedback on what your fingers are doing.</li>
                    <li>It may seem counter intuitive, but your rates over time will likely come down, not up.  Avoiding crashing requires precise control more than it does responsiveness.</li>
                    <li>Don't assume that YAW has to look anything similar to ROLL/PITCH, that'll just limit your options to explore.  At high camera angle, you'll never need a high YAW <b>Max deg/s</b>.  But, even small YAW movements may be difficult while simulaneously controlling THROTTLE.  My suggestion: Start with a fairly low <b>Slope</b> (~0.75) as this will help with precision, and then crank up <b>Mag deg/s</b> if your comfort zone is small.  Over time, reduce <b>Max deg/s</b> as your comfort zone expands.</li>
                    <li>The length of many transmitter sticks is usually adjustable and should be considered an important aspect of your rates preference.</li>
                    <li>Whether you lean towards <b>Shape=0</b> or <b>Shape=1</b>, it's ultimately just a matter of preference.  You could say that <b>Shape=0</b>'s' gradual start is linear & intuitive, or that <b>Shape=1</b>'s more consistent growth versus stick travel is best.  Both have their merits, but if in doubt, probably start with <b>Shape=1</b></li>
                </ul>
                -->
                <span style="font-size:13px;">* - Check the "<b>Lock Roll/Pitch Slope</b>" box to avoid using <b>OTX Expo</b> to give PITCH and ROLL different initial slopes.</span><br>
            </div>
        </div>
    </body>
    </body>
</html>
